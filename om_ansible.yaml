---
- name: "General tasks on all servers"
  hosts: all
  become: yes
  gather_facts: no

  tasks:
    - name: "Copy mongodb repository files"
      template: 
        src="files/hosts"
        dest="/etc/hosts"
        owner=root 
        group=root 
        mode="u=rw,g=r,o=r"

- name: Installing backing databases
  hosts: opsmgr
  become: yes
  gather_facts: no
  vars_files:
    - vars/om-install-vars.yaml
  tasks:
    # Install the Application database
    - name: "Installing Application Database"
      include: tasks/install-backing-dbs.yaml

    # Install Ops Manager
    - name: "Installing Ops Manager"
      include: tasks/install-om.yaml